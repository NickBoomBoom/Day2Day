<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="./js/tinymce.min.js"></script>
</head>

<body>


  <form>


    <textarea id="editor">
      我是测试数据
  </textarea>

    <button style="display: none;" name="submitbtn"></button>
  </form>

  <script>




    function registerSlashCommands(editor) {
      const insertActions = [
        {
          text: '标题 1(h1)',
          icon: 'h1',
          action: function () {
            editor.execCommand('mceInsertContent', false, '<h1>标题 1</h1>')
            editor.selection.select(editor.selection.getNode());
          }
        },
        {
          text: '标题 2(h2)',
          icon: 'h2',
          action: function () {
            editor.execCommand('mceInsertContent', false, '<h2>标题 2</h2>');
            editor.selection.select(editor.selection.getNode());
          }
        },
        {
          text: '标题 3(h3)',
          icon: 'h3',
          action: function () {
            editor.execCommand('mceInsertContent', false, '<h3>标题 3</h3>');
            editor.selection.select(editor.selection.getNode());
          }
        },
        {
          text: '水平分割线(hr)',
          icon: 'horizontal-rule',
          action: function () {
            editor.execCommand('mceInsertContent', false, '<hr/>');
          }
        },

        {
          type: 'separator'
        },
        {
          icon: 'bold',
          getText: () => {
            const bol = editor.queryCommandState("Bold")
            if (bol) {
              return '关闭粗体(close-bold)'
            }
            return '开启粗体(bold)'
          },
          action: function () {
            editor.execCommand('Bold');
          }
        },
        {
          icon: 'italic',
          getText: () => {
            const bol = editor.queryCommandState("Italic")
            if (bol) {
              return '关闭斜体(close-italic)'
            }
            return '开启斜体(italic)'
          },
          action: function () {
            editor.execCommand('Italic');
          }
        },

        {
          icon: 'strike-through',
          getText: () => {
            const bol = editor.queryCommandState("Strikethrough")
            if (bol) {
              return '关闭删除线(close-strikethrough)'
            }
            return '开启删除线(strikethrough)'
          },
          action: function () {
            editor.execCommand('Strikethrough');
          }
        },

        {
          icon: 'underline',
          getText: () => {
            const bol = editor.queryCommandState("Underline")
            if (bol) {
              return '关闭下划线(close-underline)'
            }
            return '开启下划线(underline)'
          },
          action: function () {
            editor.execCommand('Underline');
          }
        },
       

        {
          type: 'separator'
        },

        {
          text: '无序列表(unordered-list)',
          icon: 'unordered-list',
          action: function () {
            editor.execCommand('InsertUnorderedList', false);
          }
        },

        {
          text: '有序列表(ordered-list)',
          icon: 'ordered-list',
          action: function () {
            editor.execCommand('InsertOrderedList', false);
          }
        },
        {
          text: '任务列表(check-list)',
          icon: 'selected',
          action: function () {
            editor.execCommand("InsertUnorderedList", false, {
              "list-attributes": {
                class: "tox-checklist"
              }
            })
          }
        },
        {
          type: 'separator'
        },

        {
          text: '插入图片(image)',
          icon: 'image',
          action: function () {
            editor.execCommand('mceImage');
          }
        },
        {
          text: '插入音视频(media)',
          icon: 'embed',
          action: function () {
            editor.execCommand('mceMedia');
          }
        },
        {
          text: '插入表格(table)',
          icon: 'table',
          action: function () {
            editor.execCommand('mceInsertTableDialog');
          }
        },

        {
          text: '特殊字符(chars)',
          icon: 'insert-character',
          action: function () {
            editor.execCommand('mceShowCharmap');
          }
        },

        {
          text: 'Emoji(emoji)',
          icon: 'emoji',
          action: function () {
            editor.execCommand('mceEmoticons');
          }
        },

        {
          text: '插入代码(insert-code)',
          icon: 'code-sample',
          action: function () {
            editor.execCommand('CodeSample');
          }
        },
        {
          type: 'separator'
        },

        {
          text: '搜索替换(search-replace)',
          icon: 'search',
          action: function () {
            editor.execCommand('SearchReplace');
          
          }
        },

        {
          text: '文字方向(ltr)',
          icon: 'ltr',
          action: function () {
            editor.execCommand('mceDirectionLTR');
          }
        },
        {
          text: '文字方向(rtl)',
          icon: 'rtl',
          action: function () {
            editor.execCommand('mceDirectionRTL');
          }
        },
        {
          text: '全屏(fullscreen)',
          icon: 'fullscreen',
          action: function () {
            editor.execCommand('mceFullScreen');
          }
        },
        {
          text: '源码(source-code)',
          icon: "sourcecode",
          action: function () {
            editor.execCommand('mceCodeEditor');
          }
        },
        {
          text: '帮助',
          icon: 'help',
          action: function () {
            editor.execCommand('mceHelp');
          }
        },

      ];
      editor.ui.registry.addAutocompleter('slashcommands', {
        trigger: '/',
        minChars: 0,
        highlightOn: ['char_name'],
        columns: 1,
        fetch: function (pattern) {
          const matchedActions = insertActions.filter(function (action) {
            const text = action.getText ? action.getText() : action.text
            return action.type === 'separator' ||
              text.toLowerCase().indexOf(pattern.toLowerCase()) !== -1;
          });

          return new Promise((resolve) => {
            var results = matchedActions.map(function (action) {
              const text = action.getText ? action.getText() : action.text
              return {
                text,
                value: text,
                meta: action,
                icon: action.icon,
                type: action.type
              }
            });
            resolve(results);
          });
        },
        onAction: function (autocompleteApi, rng, action, meta) {
          editor.selection.setRng(rng);
          // Some actions don't delete the "slash", so we delete all the slash
          // command content before performing the action
          editor.execCommand('Delete');
          meta.action();
          autocompleteApi.hide();
        }
      });
    }

    tinymce.init({
      selector: "textarea",
      placeholder: "Type here...",
      auto_focus: true,
      highlight_on_focus: true,
      menubar: false,
      // skin:  'oxide',
      content_css:  ['jam','custom'],
 


  skin: 'jam',
  icons: 'jam',
      plugins: [
        'lists',  // 有序列表 无序列表 
        'table',  // 表格

        // 'anchor', // 光标定位 a标签   mceAnchor
        'link',//插入url
        'autolink', // 自动识别url 只能识别www开头的
        // 'autoresize', // 自动调整编辑器大小以适应其中的内容
        'charmap', // 特殊字符 mceShowCharmap
        'code', // 源代码查看  mceCodeEditor
        'codesample',// 源代码输入  搭配prism.js prism.css使用
        'directionality', // 文字阅读方向  mceDirectionLTR  mceDirectionRTL
        'emoticons', // emoji 表情  mceEmoticons
        'fullscreen', // 全屏插件  mceFullScreen
        'help', // 帮助文档  mceHelp

        'image', // 图片模块 mceImage
        'media',// 媒体文件  mceMedia
        'nonbreaking', // 不中断空间 mceNonBreaking
        'quickbars', // 快捷工具栏
        'save', // 保存  mceSave  mceCancel
        'autosave',// 自动保存 30s自动保存, 保留时间20m
        'searchreplace',  // SearchReplace
        'wordcount',
        'checklist'
      ],
      toolbar: "styles fontfamily table numlist bullist anchor link charmap code codesample ltr rtl emoticons fullscreen help image media nonbreaking pagebreak preview save searchreplace  checklist",
      language: 'zh_CN',
      menu: { tools: { title: 'Tools', items: 'listprops' } },
      height: '90vh',

      link_default_target: '_blank', // 链接默认打开状态

      // TODO: 图片清单,后面建立素材库,可以直接从这里面取
      // image_list: [
      //   { title: 'My image 1', value: 'https://www.example.com/my1.gif' },
      //   { title: 'My image 2', value: 'http://www.moxiecode.com/my2.gif' }
      // ],
      /* enable automatic uploads of images represented by blob or data URIs*/
      automatic_uploads: true,
      file_picker_types: 'image',
      image_caption: true,
      images_upload_url: 'http://127.0.0.1:4399/upload',



      link_context_toolbar: true,


      nonbreaking_force_tab: true,

      quickbars_insert_toolbar: "styles fontfamily fontsize",
      quickbars_selection_toolbar: `styles bold italic underline strikethrough superscript subscript fontfamily fontsize lineheight | bullist numlist checklist | blockquote quicklink removeformat | indent outdent aligncenter alignjustify alignleft alignnone alignright | backcolor forecolor |`,
      contextmenu: 'undo redo | inserttable | cell row column deletetable | help',

      // powerpaste_word_import: 'clean',
      // powerpaste_html_import: 'clean',


      save_oncancelcallback: (e) => {
        console.log('Save canceled', e);
      },
      save_onsavecallback: (e) => {
        console.log('Saved', e.getContent());
      },

      setup: (editor) => {
        registerSlashCommands(editor)

        editor.on('OpenWindow', (e ) => {
          setTimeout(() => {
            const  dialog =  document.querySelector(".tox-dialog")
            const firstTextarea = dialog.querySelector('textarea')
            const firstInput =  dialog.querySelector('input')
            const focusEl =  firstTextarea || firstInput
            if (focusEl) {
              focusEl.focus()
            }
          });
        })
 
      }



    });
  </script>
</body>

</html>